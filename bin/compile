#!/bin/bash

set -eu

metabase_plugin_csv_url="https://github.com/Markenson/csv-metabase-driver/releases/download/%s/csv.metabase-driver.jar"
metabase_plugin_csv_version="v1.3.1"


is_true() {
    if [[ "$1" = 0 ]]
    then
        false
    elif [[ -z "$1" ]]
    then
        false
    elif [[ "$1" =~ [Ff][Aa][Ll][Ss][Ee] ]]
    then
        false
    fi
}


metabase_plugins_dir="${1}/plugins"
mkdir -p "${metabase_plugins_dir}"


printf -v mb_plugin_csv_url "${metabase_plugin_csv_url}" "${metabase_plugin_csv_version}"

if is_true "${ENABLE_METABASE_CSV_PLUGIN}"
then
    echo -n "- Install CSV plugin : "
    cd "${metabase_plugins_dir}"
    curl --location --remote-name "${mb_plugin_csv_url}"
    echo "Done"
fi
